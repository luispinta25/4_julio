<div class="module-header">
    <h2 class="module-title">Caja General / Recaudación</h2>
    <div class="header-actions">
        <button class="btn btn-secondary" id="cobros-back-btn">
            <i class="fas fa-arrow-left"></i> Volver a Caja
        </button>
    </div>
</div>

<div class="grid" style="grid-template-columns: 1fr; gap: 16px;">
    <!-- BUSCADOR -->
    <div class="card">
        <h3>Buscar Socio</h3>
        <div style="display: flex; align-items: flex-end; gap: 12px; flex-wrap: wrap;">
            <div style="flex: 1; min-width: 250px;">
                <label class="form-label" for="cobros-cedula">Nombre o Cédula</label>
                <input class="form-input" id="cobros-cedula" type="text" style="width: 100%;" placeholder="Ej: 0102030405 o Juan Pérez" autocomplete="off" />
            </div>
            <div style="display: flex; gap: 8px;">
                <button class="btn btn-primary" id="cobros-buscar" style="height: 42px; white-space: nowrap;">
                    <i class="fas fa-search mr-1"></i> Consultar
                </button>
                <button class="btn btn-secondary" id="cobros-clear" style="height: 42px; width: 42px; padding: 0; display: flex; align-items: center; justify-content: center;" title="Limpiar búsqueda">
                    <i class="fas fa-undo"></i>
                </button>
            </div>
        </div>
        <p class="text-xs text-muted mt-1">Búsqueda instantánea por nombre o cédula.</p>
        
        <div id="cobros-local-results"></div>
        <div id="cobros-socio-info" class="mt-4" style="display:none;"></div>
    </div>

    <!-- DASHBOARD DE ESTADO -->
    <div class="stats-grid" id="cobros-dashboard" style="display:none;">
        <div class="stat-card">
            <div class="stat-label">Lotes</div>
            <div id="cobros-stat-lotes" class="stat-value">0</div>
            <div class="stat-sub text-muted">Cantidad de lotes vinculados</div>
        </div>
        <div class="stat-card">
            <div class="stat-label">Deuda Total</div>
            <div id="cobros-stat-pendiente" class="stat-value">$0.00</div>
            <div class="stat-sub text-muted">Suma de todas las obligaciones</div>
        </div>
    </div>

    <!-- OTROS PAGOS (PENDIENTES) -->
    <div class="card">
        <h3>Otros Cargos y Obligaciones</h3>
        <p class="text-muted text-sm mb-2">Cobros específicos, multas o cuotas extraordinarias (Calculado x Lote).</p>
        <div class="table-container">
            <table class="data-table">
                <thead>
                    <tr>
                        <th>Tipo</th>
                        <th>Descripción</th>
                        <th>Valor Unit.</th>
                        <th>Lotes</th>
                        <th>Total a Pagar</th>
                        <th>Acción</th>
                    </tr>
                </thead>
                <tbody id="cobros-otros-body">
                    <tr><td colspan="6" class="text-center p-4">Consulta un socio para ver cargos</td></tr>
                </tbody>
            </table>
        </div>
        
        <div id="cobros-admin-only" class="mt-4 hidden" style="border-top: 1px solid var(--border-color); padding-top: 1rem;">
            <button class="btn btn-secondary btn-sm" id="cobros-btn-crear-manual">
                <i class="fas fa-plus"></i> Crear Cargo Manual
            </button>
        </div>
    </div>

    <!-- MENSUALIDADES (HISTÓRICO) -->
    <div class="card">
        <h3>Pendientes / Histórico de Mensualidades</h3>
        <p class="text-muted text-sm mb-2">Cálculo basado en $ por lote y años transcurridos.</p>
        <div class="table-container">
            <table class="data-table">
                <thead>
                    <tr>
                        <th>Año</th>
                        <th>Valor (USD)</th>
                        <th>Detalle</th>
                        <th>Pendiente</th>
                        <th>Acción</th>
                    </tr>
                </thead>
                <tbody id="cobros-mensualidades-body">
                    <tr><td colspan="5" class="text-center p-4">Consulta un socio para ver mensualidades</td></tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Modal para Registrar Recaudación -->
<div id="modal-recaudacion" class="modal hidden">
    <div class="modal-backdrop"></div>
    <div class="modal-card" style="max-width: 800px; border-radius: 24px; overflow: hidden; border: none; box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.35); background: white; max-height: 95vh; display: flex; flex-direction: column;">
        <div class="modal-header" style="background: linear-gradient(135deg, var(--primary-color), #1e40af); color: white; padding: 2rem 2.5rem; border: none; position: relative; display: block; height: auto; flex-shrink: 0;">
            <div style="display: flex; align-items: center; gap: 16px;">
                <div style="background: rgba(255,255,255,0.15); width: 48px; height: 48px; border-radius: 12px; display: flex; align-items: center; justify-content: center; backdrop-filter: blur(4px);">
                    <i class="fas fa-hand-holding-usd" style="font-size: 1.4rem;"></i>
                </div>
                <div>
                    <h3 style="margin: 0; font-size: 1.5rem; font-weight: 800; color: white; letter-spacing: -0.02em;">Registrar Recaudación</h3>
                    <div id="cobros-seleccion" style="font-size: 0.95rem; opacity: 0.9; font-weight: 500; margin-top: 4px; display: flex; align-items: center; gap: 6px; color: white;"></div>
                </div>
            </div>
            <button class="modal-close" id="close-modal-recaudacion" style="color: white; opacity: 0.6; transition: all 0.2s; font-size: 1.8rem; position: absolute; right: 2rem; top: 1.8rem; background: none; border: none; cursor: pointer;">&times;</button>
        </div>
        
        <div style="background: #f8fafc; padding: 2.5rem; overflow-y: auto;">
            <form id="cobros-form-pago">
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 32px;">
                    <!-- Columna Izquierda: Datos del Pago -->
                    <div style="display: flex; flex-direction: column; gap: 24px;">
                        <div class="form-group">
                            <label class="form-label" style="font-weight: 700; color: #334155; margin-bottom: 10px; display: block; font-size: 0.9rem; text-transform: uppercase; letter-spacing: 0.025em;">Fecha del Pago</label>
                            <div style="position: relative;">
                                <i class="far fa-calendar-alt" style="position: absolute; left: 14px; top: 14px; color: #64748b; font-size: 1rem;"></i>
                                <input id="cobros-pago-fecha" class="form-input" type="date" style="padding-left: 44px; border-radius: 12px; border: 2px solid #e2e8f0; height: 48px; width: 100%; font-weight: 500; transition: border-color 0.2s;" />
                            </div>
                        </div>

                        <div class="form-group" id="field-hasta-mes" style="display:none;">
                            <label class="form-label" style="font-weight: 700; color: #334155; margin-bottom: 10px; display: block; font-size: 0.9rem; text-transform: uppercase; letter-spacing: 0.025em;">Pagar hasta (mes)</label>
                            <div style="position: relative;">
                                <i class="fas fa-calendar-check" style="position: absolute; left: 14px; top: 14px; color: #64748b; font-size: 1rem;"></i>
                                <select id="cobros-hasta-mes" class="form-input" style="padding-left: 44px; border-radius: 12px; border: 2px solid #e2e8f0; height: 48px; width: 100%; font-weight: 600; appearance: none; background-image: url('data:image/svg+xml;charset=UTF-8,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2224%22%20height%3D%2224%22%20viewBox%3D%220%200%2024%2024%22%20fill%3D%22none%22%20stroke%3D%22%2364748b%22%20stroke-width%3D%222%22%20stroke-linecap%3D%22round%22%20stroke-linejoin%3D%22round%22%3E%3Cpolyline%20points%3D%226%209%2012%2015%2018%209%22%3E%3C%2Fpolyline%3E%3C%2Fsvg%3E'); background-repeat: no-repeat; background-position: right 14px center; background-size: 16px;">
                                    <option value="1">Enero</option>
                                    <option value="2">Febrero</option>
                                    <option value="3">Marzo</option>
                                    <option value="4">Abril</option>
                                    <option value="5">Mayo</option>
                                    <option value="6">Junio</option>
                                    <option value="7">Julio</option>
                                    <option value="8">Agosto</option>
                                    <option value="9">Septiembre</option>
                                    <option value="10">Octubre</option>
                                    <option value="11">Noviembre</option>
                                    <option value="12">Diciembre</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label" style="font-weight: 700; color: #334155; margin-bottom: 10px; display: block; font-size: 0.9rem; text-transform: uppercase; letter-spacing: 0.025em;">Referencia / Comprobante</label>
                            <div style="position: relative;">
                                <i class="fas fa-receipt" style="position: absolute; left: 14px; top: 14px; color: #64748b; font-size: 1rem;"></i>
                                <input id="cobros-pago-referencia" class="form-input" type="text" placeholder="Ej: Depósito 1234, Transferencia #..." style="padding-left: 44px; border-radius: 12px; border: 2px solid #e2e8f0; height: 48px; width: 100%; transition: border-color 0.2s;" />
                            </div>
                        </div>
                    </div>

                    <!-- Columna Derecha: Monto y Observaciones -->
                    <div style="display: flex; flex-direction: column; gap: 24px;">
                        <div style="background: white; padding: 24px; border-radius: 20px; border: 2px solid #e2e8f0; box-shadow: var(--shadow-sm); position: relative; overflow: hidden;">
                            <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 16px;">
                                <label class="form-label" style="font-weight: 800; color: #1e293b; margin: 0; font-size: 0.95rem; text-transform: uppercase; letter-spacing: 0.05em;">Total a Recaudar</label>
                                <div style="font-size: 1.75rem; font-weight: 900; color: #16a34a; font-family: 'JetBrains Mono', monospace;" id="display-total-pago">$0.00</div>
                            </div>
                            <div style="position: relative;">
                                <span style="position: absolute; left: 18px; top: 12px; font-weight: 800; color: #94a3b8; font-size: 1.2rem;">$</span>
                                <input id="cobros-pago-monto" class="form-input" type="number" step="0.01" min="0" placeholder="0.00" style="padding-left: 36px; font-size: 1.5rem; font-weight: 800; color: var(--primary-color); border: 2px solid #cbd5e1; border-radius: 14px; height: 56px; width: 100%; transition: all 0.2s;" />
                            </div>
                            <div style="position: absolute; right: -20px; top: -20px; font-size: 5rem; color: #16a34a; opacity: 0.03; pointer-events: none;">
                                <i class="fas fa-coins"></i>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label" style="font-weight: 700; color: #334155; margin-bottom: 10px; display: block; font-size: 0.9rem; text-transform: uppercase; letter-spacing: 0.025em;">Notas u Observaciones</label>
                            <textarea id="cobros-pago-observaciones" class="form-input" rows="3" placeholder="Añade cualquier detalle relevante sobre este cobro..." style="border-radius: 12px; border: 2px solid #e2e8f0; padding: 16px; width: 100%; height: auto; resize: none; transition: border-color 0.2s;"></textarea>
                        </div>
                    </div>
                </div>

                <div id="cobros-pago-msg" class="inline-message mt-6" style="display:none; border-radius: 12px; padding: 1rem 1.5rem;"></div>

                <div style="margin-top: 40px; display: grid; grid-template-columns: 1fr 2fr; gap: 16px;">
                    <button type="button" class="btn btn-secondary" id="btn-cancelar-pago" style="height: 56px; border-radius: 16px; font-weight: 700; border: 2px solid #e2e8f0; background: white; color: #64748b;">
                        Cancelar
                    </button>
                    <button id="cobros-registrar" class="btn btn-primary" type="submit" style="height: 56px; border-radius: 16px; font-weight: 800; font-size: 1.1rem; background: linear-gradient(135deg, var(--primary-color), #2563eb); border: none; box-shadow: 0 10px 15px -3px rgba(37, 99, 235, 0.3); color: white; transition: all 0.2s;">
                        <i class="fas fa-check-double mr-2"></i> Procesar Recaudación
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Modal para Crear Cargo Manual -->
<div id="modal-cargo-manual" class="modal hidden">
    <div class="modal-backdrop"></div>
    <div class="modal-card" style="max-width: 650px; border-radius: 24px; box-shadow: 0 25px 50px -12px rgba(0,0,0,0.25); border: none; overflow: hidden;">
        <div class="modal-header" style="background: linear-gradient(135deg, #475569, #1e293b); padding: 1.5rem 2rem; border: none;">
            <div>
                <h3 style="margin: 0; color: white; font-weight: 800; font-size: 1.25rem; letter-spacing: -0.025em;">Crear Deuda Personalizada</h3>
                <p style="margin: 4px 0 0 0; color: rgba(255,255,255,0.7); font-size: 0.85rem;">Asigna un nuevo cargo manual a este socio</p>
            </div>
            <button class="modal-close" id="close-modal-manual" style="background: rgba(255,255,255,0.1); border: none; font-size: 1.25rem; cursor: pointer; color: white; width: 32px; height: 32px; border-radius: 8px; display: flex; align-items: center; justify-content: center;">&times;</button>
        </div>
        <div style="padding: 2.5rem; background: white;">
            <form id="cobros-form-manual">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px;">
                    <div class="form-group" style="grid-column: 1 / -1;">
                        <label class="form-label" style="font-weight: 700; color: #334155; margin-bottom: 8px; display: block; font-size: 0.9rem;">Tipo de Pago</label>
                        <select id="manual-tipo" class="form-input" required style="border-radius: 12px; height: 48px; border: 2px solid #e2e8f0;"></select>
                    </div>
                    
                    <div class="form-group" style="grid-column: 1 / -1;">
                        <label class="form-label" style="font-weight: 700; color: #334155; margin-bottom: 8px; display: block; font-size: 0.9rem;">Descripción del Cobro</label>
                        <input id="manual-desc" class="form-input" type="text" placeholder="Ej: Multa Minga, Cuota Extraordinaria..." required style="border-radius: 12px; height: 48px; border: 2px solid #e2e8f0;" />
                    </div>

                    <div class="form-group">
                        <label class="form-label" style="font-weight: 700; color: #334155; margin-bottom: 8px; display: block; font-size: 0.9rem;">Monto UNITARIO ($)</label>
                        <div style="position: relative;">
                            <span style="position: absolute; left: 14px; top: 12px; font-weight: 700; color: #64748b;">$</span>
                            <input id="manual-unitario" class="form-input" type="number" step="0.01" required style="padding-left: 32px; border-radius: 12px; height: 48px; border: 2px solid #e2e8f0; font-weight: 700;" />
                        </div>
                    </div>

                    <div style="display: flex; align-items: flex-end;">
                        <div id="manual-preview-total" style="background: #f8fafc; padding: 0 1.5rem; border-radius: 12px; height: 48px; border: 2px dashed #cbd5e1; font-weight: 700; color: #475569; display: flex; align-items: center; justify-content: center; width: 100%; font-size: 0.9rem;">
                            Total: $0.00
                        </div>
                    </div>
                </div>

                <div class="text-muted mt-2 mb-8" style="font-size: 0.8rem; color: #64748b; background: #f1f5f9; padding: 8px 12px; border-radius: 8px;">
                    <i class="fas fa-info-circle mr-1"></i> El monto se multiplicará por los lotes del socio automáticamente.
                </div>

                <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 12px;">
                    <button type="button" class="btn btn-secondary" onclick="document.getElementById('modal-cargo-manual').classList.add('hidden')" style="height: 52px; border-radius: 12px; font-weight: 700;">Cancelar</button>
                    <button type="submit" class="btn btn-primary" style="height: 52px; border-radius: 12px; font-weight: 800; background: #334155; border: none;">
                        <i class="fas fa-plus-circle mr-2"></i> Generar Cargo
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
